*** Settings ***
Library           Selenium2Library
Resource          公共方法.txt
Library           RequestsLibrary
Library           CustomLibrary

*** Variables ***
${ip}             http://10.200.9.183:8074
${username}       enler
${password}       888888
${8047_37road1}    id=mtLocationRunDiagramTree_3_span
&{bus_1}          internalno=robot    bustid=201126142457482    hostcode=robot    subid=200612134458980    roadid=417768025    belongto=100003    # 用于批量进站获取排班
&{bus_2}          internalno=robot2    bustid=201128093425842    hostcode=robot2    subid=200612134458980    roadid=417768025    belongto=100003    # 用于批量进站获取排班
&{bus_3}          internalno=robot3    bustid=201128093440756    hostcode=robot3    subid=200612134458980    roadid=417768025    belongto=100003    # 用于批量进站获取排班
&{bus_4}          internalno=robot4    bustid=201128111921140    hostcode=robot4    subid=200612134458980    roadid=417768025    belongto=100003    # 用于进站首个拿时间
&{frame}          domain_frame=id=iframe_tab_BsBusdiagarm-Maplist-417768025    sec_frame=css=#line_417768025    #domain_frame切换到37路100的主frame \ \ #sec_fram切到37路100的简图模拟图更多菜单frame
&{ImplementtingRecord_menuDict}    exchangeCar=#menu_arr1_exchangeCar>a    insertCar=#menu_arr1_insertCar>a    finishRoadPlan=#menu_arr1_finishRoadPlan>a    replaceCar=#menu_arr1_replaceCar>a    replaceDriver=#menu_arr1_replaceDriver>a    changePlantime=#menu_arr1_changePlantime>a    supplementaryDriver=#menu_arr1_supplementaryDriver>a    addPlan=#menu_arr1_addPlan>a    abandonPlan=#menu_arr1_abandonPlan>a    deletePlan=#menu_arr1_deletePlan>a    addMemo=#menu_arr1_addMemo>a    trackplayback=#menu_arr1_trackplayback>a    # exchangeCar对调车位,insertCar车辆插队,finishRoadPlan完成路单,replaceCar替换车辆,replaceDriver替换司机,changePlantime更改计划时间,supplementaryDriver补录司机,addPlan增加计划,abandonPlan计划烂班,deletePlan删除计划,deletePlan删除计划,addMemo修改备注,trackplayback轨迹回放

*** Keywords ***
登陆
    初始化基本资料
    webservice请求
    ${login_ip}    Catenate    SEPARATOR=    ${ip}    /login.koala
    log    ${login_ip}
    Open Browser    ${login_ip}    Chrome
    sleep    1
    input text    id=j_username    ${username}
    input text    id=j_password    ${password}
    input text    id=jCaptchaCode    111111
    click element    id=loginBtn
    sleep    1
    ${window}    get window titles
    #如果窗口中包含了巴士在线，则直接选择该窗口，否则重新执行“登陆”
    set global variable    ${window}
    Maximize Browser Window

关闭浏览器
    close browser

初始化基本资料
    #创建车辆Lst
    @{bustidLst}    create List    &{bus_1}[bustid]    &{bus_2}[bustid]    &{bus_3}[bustid]
    @{bustidXPAHLst}    create List    #简图调度右击目标车辆XPATH地址
    @{bustidXPAHLst_2}    create List    #简图调度左右总站获取排班信息XPATH地址
    FOR    ${bustid}    IN    @{bustidLst}
        ${bustidXPATH}    Catenate    SEPARATOR=    css=div[id='    ${bustid}    ']>div[class='bus-body']
        log    ${bustidXPATH}
        ${bustidXPATH_2}    Catenate    SEPARATOR=    xpath=//div[@id='DownStationList']/div[@id='    ${bustid}    ']/div[@class='init-plantime alpha-bg']
        log    ${bustidXPATH_2}
        Append to list    ${bustidXPAHLst}    ${bustidXPATH}
        Append to list    ${bustidXPAHLst_2}    ${bustidXPATH_2}
    END
    Set Global Variable    ${bustidXPAHLst}
    Set GLobal Variable    ${bustidXPAHLst_2}

webservice请求
    #定义请求头
    ${headers}    create dictionary
    set to dictionary    ${headers}    Content-Type=application/json;charset=UTF-8
    #定义入参
    ${caronline}    Get Caronline Json    &{bus_1}[hostcode]
    ${caronlineType}    evaluate    type($caronline)
    log    ${caronlineType}
    create session    api    ${ip}    ${headers}
    ${data}    post request    api    /webservice/rest/caronline    data=${caronline}
    ${result}    To Json    ${data.content}
    should contain    ${result}[error_text]    上报成功
