*** Settings ***
Library           Selenium2Library
Library           CustomLibrary
Library           Collections
Library           RequestsLibrary
Resource          公共方法.txt

*** Keywords ***
打开简图调度
    select window    ${window}
    click element    xpath=//a[@href='#menuMark181']    #【运营监控】
    sleep    1    #
    click element    css=li[data-mark='menuMark214']    #【简图调度】
    sleep    3
    click element    id=mtLocationRunDiagramTree_6_span    #37路100
    sleep    5

切换简图domain_frame
    #切换到简图调度frame
    Wait Until Element Is Enabled    &{frame}[domain_frame]    #切换到37路100的主frame
    Select Frame    &{frame}[domain_frame]    #切换到37路100的主frame
    sleep    2

获取简图车辆更多菜单
    [Arguments]    ${bustid}    ${dropDownPath}
    #前提需处于domain_frame
    ${bustidXPATH}    Catenate    SEPARATOR=    css=div[id='    ${bustid}    ']>div[class='bus-body']
    Wait Until Element Is Enabled    &{frame}[sec_frame]    #切到37路100的简图模拟图frame
    Select Frame    &{frame}[sec_frame]
    sleep    1
    Right Click Element    ${bustidXPATH}    #车辆bustid
    sleep    2
    unselect Frame
    Select Frame    &{frame}[domain_frame]    #对车辆要执行的操作
    sleep    1
    click element    ${dropDownPath}
    sleep    1

获取简图调度字轨表中的排班时间
    [Documentation]    \#前提打开简图调度
    ...
    ...
    ...    获取简图调度字轨表中的排班时间
    #以下步骤需进入简图调度domain_frame中操作，即
    #Select Frame    &{frame}[domain_frame]
    click element    xpath=//div[contains(text(),'排班间隔')]    #简图上方“排班间隔”
    sleep    2
    ${plantimeCount}    get element count    xpath=//label[@style='color:#4c4c4c;' or @style='color:#00BA00;']    #返回元素的个数，即字轨表中有多少个排班时间
    Set Global Variable    ${plantimeCount}
    @{plantimeElements}    get webelements    xpath=//label[@style='color:#4c4c4c;' or @style='color:#00BA00;']    #返回多个元素.@style='color:#4c4c4c;' 代表已过期时间。@style='color:#00BA00;' 代表未来时间
    Set Global Variable    @{plantimeElements}
    FOR    ${plan}    IN    @{plantimeElements}
        ${time}    get text    ${plan}
        log    ${time}
    END
    click element    xpath=//button[contains(text(),"返回")]    #关闭字轨表页面

三台车手动进站获取排班时间
    [Arguments]    @{bustidLst}
    @{plantimeLst}    create list    #创建plantimeLst列表
    Set Global Variable    @{plantimeLst}
    #创建车辆Lst
    #定位两个变量定位器
    FOR    ${bustid}    IN    @{bustidLst}
        ${bustidXPATH_2}    Catenate    SEPARATOR=    xpath=//div[@id='DownStationList']/div[@id='    ${bustid}    ']/div[@class='init-plantime alpha-bg']
        切换简图domain_frame
        获取简图车辆更多菜单    ${bustid}    &{dropdown_menuDict}[goToSite]
        click element    xpath=//button[@id='save']    #对车辆手动“进站”保存
        sleep    3
        Wait Until Element Is Enabled    &{frame}[sec_frame]
        Select Frame    &{frame}[sec_frame]
        ${plantime}    get text    ${bustidXPATH_2}    #尝试获取简图上该车辆当前排班计划
        unselect frame
        Append to list    ${plantimeLst}    ${plantime}    #将三台车的排班时间装入到LST当中，用于后续的结果验证
    END
    log many    @{plantimeLst}
    List Should Not Contain Duplicates    ${plantimeLst}    #判断列表中是否存在重复数据，如果出现重复数据，则判断为False.注意此方法在引用变量时，要使用$前缀
    #车辆停运再恢复运营，恢复测试初状态
    @{hostcodeLst}    create List    &{bus_1}[hostcode]    &{bus_2}[hostcode]    &{bus_3}[hostcode]
    FOR    ${hostcode}    IN    @{hostcodeLst}
        ${dispathJson}    Get Dispath Json    ${hostcode}    6
        ${data}    post request    api    /webservice/rest/dispatch    data=${dispathJson}
        ${result}    To Json    ${data.content}
        should contain    ${result}[error_text]    上报成功
        sleep    3
        ${dispathJson}    Get Dispath Json    ${hostcode}    106
        ${data2}    post request    api    /webservice/rest/dispatch    data=${dispathJson}
        ${result}    To Json    ${data2.content}
        should contain    ${result}[error_text]    上报成功
        sleep    3
    END

车辆手动进站
    [Arguments]    ${bustid}
    #车辆手动进站
    获取简图车辆更多菜单    ${bustid}    &{dropdown_menuDict}[goToSite]
    click element    xpath=//button[@id='save']    #对车辆手动“进站”保存    #此时frame停留在domain_frame中

获取”待执行“路单更多菜单
    [Arguments]    ${menu_css}
    打开简图调度
    Right Click Element    xpath=//div[@id='road_order_detail_grid2_417768025']//tr[@data-index="0"]
    #获取第一条待执行的路单
    sleep    2
    Right Click Element    css=${menu_css}
    sleep    1
